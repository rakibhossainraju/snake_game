var k=Object.defineProperty;var _=(l,t,e)=>t in l?k(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var c=(l,t,e)=>_(l,typeof t!="symbol"?t+"":t,e);import{W as y,D as w,G as g}from"./index-DjDWgFLX.js";const S=8;function b(){return{CELL_SIZE:32,WORLD_SIZE:S,SNAKE_SPAWN_IDX:Math.floor(Math.random()*S*S),MOVEMENT_FRAMES:10,canvasId:"snake-canvas",pointsElementId:"points-count"}}class u{static roundRect(t,e,i,s,o,n){t.beginPath(),t.moveTo(e+n,i),t.lineTo(e+s-n,i),t.arcTo(e+s,i,e+s,i+n,n),t.lineTo(e+s,i+o-n),t.arcTo(e+s,i+o,e+s-n,i+o,n),t.lineTo(e+n,i+o),t.arcTo(e,i+o,e,i+o-n,n),t.lineTo(e,i+n),t.arcTo(e,i,e+n,i,n),t.closePath()}static drawPointedTail(t,e,i,s,o,n){const r=e+o,a=i+o,h=s-o*2;switch(t.beginPath(),n){case 0:t.moveTo(r,a+h),t.lineTo(r+h/2,a),t.lineTo(r+h,a+h);break;case 1:t.moveTo(r,a),t.lineTo(r+h,a+h/2),t.lineTo(r,a+h);break;case 2:t.moveTo(r,a),t.lineTo(r+h/2,a+h),t.lineTo(r+h,a);break;case 3:t.moveTo(r+h,a),t.lineTo(r,a+h/2),t.lineTo(r+h,a+h);break}t.closePath(),t.fill()}}class I{constructor(t,e,i){this.ctx=t,this.config=e,this.worldSize=i}drawSnake(t,e,i){for(const[s,o]of t.entries()){const n=o%this.worldSize,r=Math.floor(o/this.worldSize),a=this.config.CELL_SIZE*n,h=this.config.CELL_SIZE*r,d=this.config.CELL_SIZE,x=1;if(this.ctx.beginPath(),s===0)this.drawSnakeHead(a,h,d,x,e(),i);else if(s===t.length-1){const R=this.getTailDirection(t,s),m=s/t.length,E=Math.floor(46+-20*m),T=Math.floor(204+-30*m),L=Math.floor(113+46*m);this.ctx.fillStyle=`rgb(${E}, ${T}, ${L})`,u.drawPointedTail(this.ctx,a,h,d,x,R)}else this.drawSnakeBodySegment(a,h,d,x,s,t.length)}}drawSnakeHead(t,e,i,s,o,n){this.ctx.fillStyle="#2ecc71",u.roundRect(this.ctx,t+s,e+s,i-s*2,i-s*2,5),this.ctx.fill();const r=this.getEyePositions(t,e,i,o),a=i/8;n?this.drawXEyes(r,a):this.drawNormalEyes(r,a)}getEyePositions(t,e,i,s){switch(s){case 0:return{eyeX1:t+i/3,eyeX2:t+i*2/3,eyeY1:e+i/3,eyeY2:e+i/3};case 2:return{eyeX1:t+i/3,eyeX2:t+i*2/3,eyeY1:e+i*2/3,eyeY2:e+i*2/3};case 3:return{eyeX1:t+i/3,eyeX2:t+i/3,eyeY1:e+i/3,eyeY2:e+i*2/3};case 1:default:return{eyeX1:t+i*2/3,eyeX2:t+i*2/3,eyeY1:e+i/3,eyeY2:e+i*2/3}}}drawXEyes(t,e){const{eyeX1:i,eyeX2:s,eyeY1:o,eyeY2:n}=t;this.ctx.strokeStyle="#ff0000",this.ctx.lineWidth=2,this.drawXShape(i,o,e),this.drawXShape(s,n,e)}drawXShape(t,e,i){this.ctx.beginPath(),this.ctx.moveTo(t-i,e-i),this.ctx.lineTo(t+i,e+i),this.ctx.moveTo(t+i,e-i),this.ctx.lineTo(t-i,e+i),this.ctx.stroke()}drawNormalEyes(t,e){const{eyeX1:i,eyeX2:s,eyeY1:o,eyeY2:n}=t;this.ctx.fillStyle="#000",this.drawCircle(i,o,e),this.drawCircle(s,n,e)}drawCircle(t,e,i){this.ctx.beginPath(),this.ctx.arc(t,e,i,0,Math.PI*2),this.ctx.fill()}drawSnakeBodySegment(t,e,i,s,o,n){const r=o/n,a=Math.floor(46+-20*r),h=Math.floor(204+-30*r),d=Math.floor(113+46*r);this.ctx.fillStyle=`rgb(${a}, ${h}, ${d})`,u.roundRect(this.ctx,t+s,e+s,i-s*2,i-s*2,3),this.ctx.fill()}getTailDirection(t,e){if(e<1||e>=t.length)return 0;const i=t[e],s=t[e-1];return this.calculateDirection(i%this.worldSize,Math.floor(i/this.worldSize),s%this.worldSize,Math.floor(s/this.worldSize))}calculateDirection(t,e,i,s){return Math.abs(t-i)>1?t>i?3:1:Math.abs(e-s)>1?e>s?0:2:t<i?3:t>i?1:e<s?0:e>s?2:0}}class p{constructor(t,e,i){this.ctx=t,this.config=e,this.worldSize=i}getPulsingScale(){return .9+.2*(Math.sin(Date.now()/500)+1)/2}drawFood(t){if(!t)return;const e=t%this.worldSize,i=Math.floor(t/this.worldSize),s=this.config.CELL_SIZE*e,o=this.config.CELL_SIZE*i,n=this.config.CELL_SIZE,r=s+n/2,a=o+n/2,h=this.getPulsingScale(),d=(n/2-2)*h;this.ctx.save(),this.ctx.translate(r,a),this.ctx.scale(h,h),this.ctx.translate(-r,-a),this.ctx.beginPath(),this.ctx.fillStyle="#e74c3c",this.ctx.arc(r,a,d/h,0,Math.PI*2),this.ctx.fill(),this.ctx.restore(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.arc(r-d/3,a-d/3,d/3,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="#2ecc71",this.ctx.ellipse(r+3,o+3,3,5,Math.PI/4,0,Math.PI*2),this.ctx.fill()}}class G{constructor(t,e,i){this.ctx=t,this.config=e,this.worldSize=i}drawGrid(){const{CELL_SIZE:t}=this.config;this.ctx.fillStyle="#1a1a2e",this.ctx.fillRect(0,0,this.worldSize*t,this.worldSize*t),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(52, 73, 94, 0.5)",this.ctx.lineWidth=1;for(let e=0;e<=this.worldSize;e++)this.ctx.moveTo(t*e,0),this.ctx.lineTo(t*e,this.worldSize*t),this.ctx.moveTo(0,t*e),this.ctx.lineTo(t*this.worldSize,t*e);this.ctx.stroke();for(let e=0;e<this.worldSize;e++)for(let i=0;i<this.worldSize;i++)(e+i)%2===0&&(this.ctx.fillStyle="rgba(52, 73, 94, 0.1)",this.ctx.fillRect(i*t,e*t,t,t))}}class P{constructor(t,e){this.ctx=t,this.canvas=e}displayGameOver(t){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ff3333",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2-15),this.displayScoreAndRestartText(t)}displayGameWon(t){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#33ff33",this.ctx.font="bold 24px Arial",this.ctx.textAlign="center",this.ctx.fillText("YOU WIN!",this.canvas.width/2,this.canvas.height/2-15),this.displayScoreAndRestartText(t)}displayStartScreen(){this.ctx.fillStyle="rgba(26, 26, 46, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle="#3498db",this.ctx.lineWidth=6,this.ctx.strokeRect(10,10,this.canvas.width-20,this.canvas.height-20);const t=this.canvas.width/2,e=this.canvas.height/2-50;for(let i=0;i<5;i++)this.ctx.fillStyle=i===0?"#2ecc71":"#27ae60",u.roundRect(this.ctx,t-50+i*20,e,18,18,5),this.ctx.fill();this.ctx.beginPath(),this.ctx.fillStyle="#e74c3c",this.ctx.arc(t+60,e+9,9,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ecf0f1",this.ctx.font='bold 28px "Segoe UI", sans-serif',this.ctx.textAlign="center",this.ctx.fillText("SNAKE GAME",t,this.canvas.height/2+20),this.ctx.fillStyle="#3498db",this.ctx.font='bold 20px "Segoe UI", sans-serif',this.ctx.fillText("Press SPACE to Start",t,this.canvas.height/2+60),this.ctx.fillStyle="#bdc3c7",this.ctx.font='14px "Segoe UI", sans-serif',this.ctx.fillText("Use arrow keys to control the snake",t,this.canvas.height/2+90)}displayScoreAndRestartText(t){this.ctx.fillStyle="#ffffff",this.ctx.font="16px Arial",this.ctx.fillText(`Score: ${t}`,this.canvas.width/2,this.canvas.height/2+15),this.ctx.font="14px Arial",this.ctx.fillText("Press SPACE to restart",this.canvas.width/2,this.canvas.height/2+45)}updateScore(t,e){t&&(t.textContent=e.toString(),e>=10?(t.style.color="#f39c12",e>=20&&(t.style.color="#e74c3c",e>=30&&(t.style.color="#8e44ad"))):t.style.color="#e74c3c",t.classList.add("score-pulse"),setTimeout(()=>{t==null||t.classList.remove("score-pulse")},300))}}const f=class f{constructor(){c(this,"getSnakeBody",null);c(this,"config");c(this,"canvas",null);c(this,"ctx",null);c(this,"pointsElement",null);c(this,"world");c(this,"worldSize");c(this,"isGameRunning",!1);c(this,"frameCount",0);c(this,"snakeRenderer",null);c(this,"foodRenderer",null);c(this,"gridRenderer",null);c(this,"uiRenderer",null);c(this,"handleDirectionChange",t=>{switch(t.key){case"ArrowLeft":this.world.change_direction(w.Left),t.preventDefault();break;case"ArrowRight":this.world.change_direction(w.Right),t.preventDefault();break;case"ArrowDown":this.world.change_direction(w.Down),t.preventDefault();break;case"ArrowUp":this.world.change_direction(w.Up),t.preventDefault();break;default:return}});c(this,"handleGameStart",t=>{t.code==="Space"&&this.world.get_game_state()===g.Ready&&(document.removeEventListener("keydown",this.handleGameStart),this.world.game_start(),t.preventDefault())});c(this,"handleRestart",t=>{t.code==="Space"&&(document.removeEventListener("keydown",this.handleRestart),this.resetGame(),t.preventDefault())});if(this.config=b(),this.world=y.new(this.config.WORLD_SIZE,this.config.SNAKE_SPAWN_IDX),this.worldSize=this.world.get_width(),this.canvas=document.getElementById(this.config.canvasId),this.pointsElement=document.getElementById(this.config.pointsElementId),!this.canvas){console.error(`Canvas with ID '${this.config.canvasId}' not found in the document`),this.worldSize=0;return}if(this.ctx=this.canvas.getContext("2d"),!this.ctx){console.error("Failed to get 2D context from canvas element");return}this.initializeRenderers()}initializeRenderers(){!this.ctx||!this.canvas||(this.snakeRenderer=new I(this.ctx,this.config,this.worldSize),this.foodRenderer=new p(this.ctx,this.config,this.worldSize),this.gridRenderer=new G(this.ctx,this.config,this.worldSize),this.uiRenderer=new P(this.ctx,this.canvas))}static getInstance(){return f.instance||(f.instance=new f),f.instance}initGame(t){if(this.getSnakeBody=t,!this.canvas||!this.ctx){console.error("Cannot initialize game: Canvas or context is not available");return}this.canvas.height=this.config.CELL_SIZE*this.worldSize,this.canvas.width=this.config.CELL_SIZE*this.worldSize,this.isGameRunning||(this.isGameRunning=!0,document.addEventListener("keydown",this.handleDirectionChange),document.addEventListener("keydown",this.handleGameStart),this.startGameLoop())}startGameLoop(){requestAnimationFrame(()=>{!this.ctx||!this.canvas||!this.isGameRunning||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderFrame(),this.world.get_game_state()===g.Playing&&(this.frameCount++,this.frameCount>=this.config.MOVEMENT_FRAMES&&(this.world.step(),this.frameCount=0)),this.startGameLoop())})}renderFrame(){if(!this.gridRenderer||!this.snakeRenderer||!this.foodRenderer||!this.uiRenderer||!this.getSnakeBody)return;this.gridRenderer.drawGrid();const t=this.world.get_game_state();if(t===g.Ready)this.uiRenderer.displayStartScreen();else{const e=this.getSnakeBody(this.world.get_first_cell_ptr(),this.world.get_snake_len());this.snakeRenderer.drawSnake(e,()=>this.world.get_direction(),t===g.GameOver);const i=this.world.get_food_idx();i&&this.foodRenderer.drawFood(i),this.uiRenderer.updateScore(this.pointsElement,this.world.get_point()),this.checkGameState()}}checkGameState(){if(!this.uiRenderer)return;const t=this.world.get_game_state(),e=this.world.get_point();t===g.GameOver?(this.uiRenderer.displayGameOver(e),this.stopGame()):t===g.Won&&(this.uiRenderer.displayGameWon(e),this.stopGame())}stopGame(){this.isGameRunning=!1,document.removeEventListener("keydown",this.handleDirectionChange),document.addEventListener("keydown",this.handleRestart)}resetGame(){const t=Math.floor(Math.random()*S*S);this.world=y.new(this.config.WORLD_SIZE,t),this.isGameRunning=!0,document.addEventListener("keydown",this.handleDirectionChange),document.addEventListener("keydown",this.handleGameStart),this.startGameLoop()}};c(f,"instance");let v=f;const C=v.getInstance();function A(l){C.initGame(l)}export{A as main};
